@{
    ViewData["Title"] = "周报管理系统";
}


<div class="layui-layout layui-layout-admin">

    @await Html.PartialAsync("PartialHeader");

    @await Html.PartialAsync("PartialMenue");

    <div class="layui-body">
        @await Html.PartialAsync("PartialContent");
    </div>

    @await Html.PartialAsync("PartialBottom");
</div>


@section Scripts{
    <script>
            layui.use(['element', 'layer', 'util'], function () {
            var element = layui.element
                , layer = layui.layer
                , util = layui.util
                , $ = layui.$;


            //监听左侧菜单点击，添加iframe选项卡。
            element.on('nav(leftNav)', function (elem) {
                if (elem == null || elem.length <= 0) {
                    return;
                }
                var navA = $(elem[0]);

                var id = navA.attr('data-id');
                var url = navA.attr('data-url');
                var text = navA.attr('data-text');
                if (!url) {
                    return;
                }
                var isActive = $('.layui-tab-title').find("li[lay-id=" + id + "]");
                if (isActive.length > 0) {
                    //切换到选项卡
                    element.tabChange('tab', id);
                } else {
                    //获取tab个数
                    var tabCount = $('.layout-body .layout-tab .layui-tab-title li').length;
                    if (tabCount > 10) {
                        layer.alert('请先关闭一些选项卡（最多允许打开10个）', {
                            icon: 5
                        });
                    }
                    else {
                        element.tabAdd('tab', {
                            title: text,
                            content: '<iframe src="' + url + '" id="menu_iframe_' + id + '" name="iframe' + id + '" class="iframe" framborder="0" data-id="' + id + '" scrolling="auto" width="100%"  height="100%"></iframe>',
                            id: id
                        });
                        element.tabChange('tab', id);
                    }

                }

                //点击iframe选项卡，选中相应的菜单。
                //$('.layout-body .layui-tab-title li', window.parent.document).click(function () {
                $('.layui-tab .layui-tab-title li').click(function () {
                    var tab_lay_this = $(this).attr('lay-id')
                    //var lay_li_ln = $('.layui-nav-child', window.parent.document).find('a')
                    //var tab_lay_ln = $('.layui-tab-title li', window.parent.document)
                    var lay_li_ln = $('.layui-nav-child').find('a')
                    var tab_lay_ln = $('.layui-tab-title li')
                    //console.log(tab_lay_this)
                    $.each(lay_li_ln, function (i, item) {
                        var currentId = $(item).attr('data-id')
                        if (tab_lay_this == currentId) {
                            ////$('.layui-nav-child', window.parent.document).find('a').parents('.layui-nav-item').removeClass('layui-nav-itemed')
                            //$('.layui-nav-child', window.parent.document).find('a').parents('dd').removeClass('layui-this')
                            //$('.layui-nav-child', window.parent.document).find('a').eq(i).parents('.layui-nav-item').addClass('layui-nav-itemed')
                            //$('.layui-nav-child', window.parent.document).find('a').eq(i).parents('dd').addClass('layui-this')
                            $('.layui-nav-child').find('a').parents('dd').removeClass('layui-this')
                            $('.layui-nav-child').find('a').eq(i).parents('.layui-nav-item').addClass('layui-nav-itemed')
                            $('.layui-nav-child').find('a').eq(i).parents('dd').addClass('layui-this')
                        } else if (tab_lay_this == undefined) {
                            ////$('.layui-nav-child', window.parent.document).find('a').parents('.layui-nav-item').removeClass('layui-nav-itemed')
                            //$('.layui-nav-child', window.parent.document).find('a').parents('dd').removeClass('layui-this')
                            $('.layui-nav-child').find('a').parents('dd').removeClass('layui-this')
                        }
                    })
                });
            });


            //头部菜单点击事件
            util.event('lay-header-event', {
                //头部左侧菜单事件
                menuLeft: function (othis) {
                    layer.msg('展开左侧菜单的操作', { icon: 0 });
                }
                //头部右侧菜单事件
                , menuRight: function () {
                    layer.open({
                        type: 1
                        , content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                        , area: ['260px', '100%']
                        , offset: 'rt' //右上角
                        , anim: 5
                        , shadeClose: true
                    });
                }
            });

            //触发事件-点击PartialContent.cshtml中的三个按钮，触发的事件。
            var active = {
                tabAdd: function () {
                    //新增一个Tab项
                    element.tabAdd('tab', {
                        title: '新选项' + (Math.random() * 1000 | 0) //用于演示
                        , content: '内容' + (Math.random() * 1000 | 0)
                        , id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                    })
                }
                , tabDelete: function (othis) {
                    //删除指定Tab项
                    element.tabDelete('tab', '44'); //删除：“商品管理”

                    othis.addClass('layui-btn-disabled');
                }
                , tabChange: function () {
                    //切换到指定Tab项
                    element.tabChange('tab', '22'); //切换到：用户管理
                }
                , tabDefault: function () {
                    $("a[data-url='/UReport']").trigger("click"); //切换到：用户管理
                    $("li[lay-id='5']").trigger("click");   //触发打开对应的菜单。
                }
            };
            active.tabDefault();    //增加默认打开窗口。

            $('.site-demo-active').on('click', function () {
                var othis = $(this), type = othis.data('type');
                active[type] ? active[type].call(this, othis) : '';
            });

            
            $('.wk-btn').on('click', function () {  //头像处点击，显示出的消息
                var type = $(this).attr("id");
                eval(type + "()");
            });

        });

        function updatePass(){
             lay_extend.openwin({
                 title: '修改密码',
                 page_path: '/Views/Account/Modifypwd.cshtml',
                 cancel: function () {    
                     window.location.href="/Account/LogOut";
                 }
             });
        }
    </script>
}